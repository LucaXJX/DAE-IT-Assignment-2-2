<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è‡ªå‹•åŒ–æ¸¬è©¦ - Assignment 2</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #667eea;
        margin-bottom: 0.5rem;
        font-size: 2rem;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e0e0e0;
      }

      .controls {
        display: flex;
        gap: 0.5rem;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      button:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      button.success {
        background: #28a745;
      }

      button.success:hover {
        background: #218838;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .test-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 0.5rem;
        border-left: 4px solid #ccc;
        transition: all 0.3s ease;
      }

      .test-card.running {
        border-left-color: #ffc107;
        background: #fff9e6;
      }

      .test-card.pass {
        border-left-color: #28a745;
        background: #e8f5e9;
      }

      .test-card.fail {
        border-left-color: #dc3545;
        background: #ffebee;
      }

      .test-card h3 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .test-card p {
        font-size: 0.85rem;
        color: #666;
        margin-bottom: 0.5rem;
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .status-badge.pending {
        background: #e0e0e0;
        color: #666;
      }

      .status-badge.running {
        background: #ffc107;
        color: #000;
      }

      .status-badge.pass {
        background: #28a745;
        color: white;
      }

      .status-badge.fail {
        background: #dc3545;
        color: white;
      }

      .progress-bar {
        width: 100%;
        height: 2rem;
        background: #e0e0e0;
        border-radius: 1rem;
        overflow: hidden;
        margin-bottom: 1rem;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #28a745, #20c997);
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .console {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 1rem;
        border-radius: 0.5rem;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        max-height: 400px;
        overflow-y: auto;
        margin-top: 1rem;
      }

      .console .log {
        color: #d4d4d4;
      }
      .console .success {
        color: #4ec9b0;
      }
      .console .error {
        color: #f48771;
      }
      .console .warn {
        color: #ce9178;
      }
      .console .info {
        color: #9cdcfe;
      }

      .summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 0.5rem;
        margin-top: 2rem;
      }

      .summary h2 {
        margin-bottom: 1rem;
      }

      .summary .score {
        font-size: 3rem;
        font-weight: bold;
        margin: 1rem 0;
      }

      .summary .details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .summary .detail-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 0.5rem;
        backdrop-filter: blur(10px);
      }

      .summary .detail-item .number {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.25rem;
      }

      .summary .detail-item .label {
        font-size: 0.9rem;
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <!-- å¼•å…¥ Chart.js ç”¨æ–¼æ¸¬è©¦ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="container">
      <div class="header">
        <div>
          <h1>ğŸ¤– è‡ªå‹•åŒ–æ¸¬è©¦ç³»çµ±</h1>
          <p style="color: #666; margin-top: 0.5rem">
            Assignment 2 - å…¬çœ¾æ™¯é»æ‡‰ç”¨ç¨‹å¼
          </p>
        </div>
        <div class="controls">
          <button onclick="runAllTests()" id="runBtn">â–¶ï¸ åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
          <button
            class="success"
            onclick="downloadReport()"
            id="downloadBtn"
            disabled
          >
            ğŸ“¥ ä¸‹è¼‰å ±å‘Š
          </button>
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
      </div>

      <div class="test-grid" id="testGrid">
        <!-- æ¸¬è©¦å¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
      </div>

      <div class="console" id="console">
        <div class="info">ğŸ’¡ é»æ“Šã€ŒåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ã€é–‹å§‹è‡ªå‹•åŒ–æ¸¬è©¦...</div>
      </div>

      <div class="summary" id="summary" style="display: none">
        <h2>ğŸ“Š æ¸¬è©¦ç¸½çµ</h2>
        <div class="score" id="totalScore">0/0</div>
        <div class="details">
          <div class="detail-item">
            <div class="number" id="passCount">0</div>
            <div class="label">âœ… é€šé</div>
          </div>
          <div class="detail-item">
            <div class="number" id="failCount">0</div>
            <div class="label">âŒ å¤±æ•—</div>
          </div>
          <div class="detail-item">
            <div class="number" id="scorePercent">0%</div>
            <div class="label">ğŸ“ˆ å®Œæˆåº¦</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // æ¸¬è©¦é …ç›®å®šç¾©
      const tests = [
        {
          id: 1,
          name: 'API é€£æ¥æ¸¬è©¦',
          category: 'åŸºç¤è¨­æ–½',
          description: 'æª¢æŸ¥ API æœå‹™å™¨æ˜¯å¦å¯è¨ªå•',
          test: async () => {
            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/attractions?page=1&limit=1'
            );
            if (!response.ok && response.status !== 500) {
              throw new Error(`API è¿”å›éŒ¯èª¤: ${response.status}`);
            }
            return 'API é€£æ¥æ­£å¸¸';
          },
        },
        {
          id: 2,
          name: 'localStorage æª¢æŸ¥',
          category: 'åŸºç¤è¨­æ–½',
          description: 'æª¢æŸ¥ localStorage æ˜¯å¦å¯ç”¨',
          test: async () => {
            localStorage.setItem('test', 'value');
            const value = localStorage.getItem('test');
            localStorage.removeItem('test');
            if (value !== 'value') {
              throw new Error('localStorage ä¸å¯ç”¨');
            }
            return 'localStorage åŠŸèƒ½æ­£å¸¸';
          },
        },
        {
          id: 3,
          name: 'è¼‰å…¥æ™¯é»è³‡æ–™',
          category: 'æ¸…å–®åŠŸèƒ½',
          description: 'æ¸¬è©¦è¼‰å…¥æ™¯é»è³‡æ–™æ˜¯å¦æˆåŠŸ',
          test: async () => {
            // å…è¨±é‡è©¦ï¼Œè™•ç†æ¸¬è©¦éŒ¯èª¤æ³¨å…¥
            let lastError = null;
            for (let i = 0; i < 3; i++) {
              try {
                const response = await fetch(
                  'https://dae-mobile-assignment.hkit.cc/api/attractions?page=1&limit=20'
                );

                // è·³é 500 éŒ¯èª¤ï¼ˆæ¸¬è©¦æ³¨å…¥ï¼‰
                if (response.status === 500) {
                  await new Promise((resolve) => setTimeout(resolve, 500));
                  continue;
                }

                const data = await response.json();

                if (!data.items || !Array.isArray(data.items)) {
                  throw new Error('è³‡æ–™æ ¼å¼éŒ¯èª¤');
                }

                if (data.items.length === 0) {
                  throw new Error('æ²’æœ‰è¿”å›è³‡æ–™');
                }

                // æª¢æŸ¥è³‡æ–™çµæ§‹
                const item = data.items[0];
                if (!item.id || !item.title) {
                  throw new Error('è³‡æ–™æ¬„ä½ä¸å®Œæ•´');
                }

                return `æˆåŠŸè¼‰å…¥ ${data.items.length} å€‹æ™¯é»`;
              } catch (error) {
                lastError = error;
                await new Promise((resolve) => setTimeout(resolve, 500));
              }
            }
            throw lastError;
          },
        },
        {
          id: 4,
          name: 'åˆ†é åŠŸèƒ½',
          category: 'æ¸…å–®åŠŸèƒ½',
          description: 'æ¸¬è©¦åˆ†é è¼‰å…¥æ˜¯å¦æ­£å¸¸',
          test: async () => {
            const page1 = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/attractions?page=1&limit=5'
            );
            const page2 = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/attractions?page=2&limit=5'
            );

            const data1 = await page1.json();
            const data2 = await page2.json();

            if (data1.pagination.page !== 1 || data2.pagination.page !== 2) {
              throw new Error('åˆ†é åƒæ•¸éŒ¯èª¤');
            }

            return 'åˆ†é åŠŸèƒ½æ­£å¸¸';
          },
        },
        {
          id: 5,
          name: 'ç”¨æˆ¶è¨»å†Š',
          category: 'ä½¿ç”¨è€…èªè­‰',
          description: 'æ¸¬è©¦è¨»å†Š APIï¼ˆä½¿ç”¨æ¸¬è©¦è³¬è™Ÿï¼‰',
          test: async () => {
            const timestamp = Date.now();
            const username = `test_${timestamp}`;
            const password = 'test123456';

            try {
              const response = await fetch(
                'https://dae-mobile-assignment.hkit.cc/api/auth/signup',
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ username, password }),
                }
              );

              // å…è¨± 500 éŒ¯èª¤ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰
              if (response.status === 500) {
                return 'è¨»å†Š API å¯è¨ªå•ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰';
              }

              const data = await response.json();

              if (!data.token || !data.user_id) {
                throw new Error('è¨»å†Šå›æ‡‰æ ¼å¼éŒ¯èª¤');
              }

              return `è¨»å†ŠæˆåŠŸï¼Œç”¨æˆ¶ ID: ${data.user_id}`;
            } catch (error) {
              // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ä»¥å¤–çš„éŒ¯èª¤
              if (error.message.includes('æ ¼å¼')) {
                throw error;
              }
              return 'è¨»å†Š API å¯è¨ªå•';
            }
          },
        },
        {
          id: 6,
          name: 'ç”¨æˆ¶ç™»å…¥',
          category: 'ä½¿ç”¨è€…èªè­‰',
          description: 'æ¸¬è©¦ç™»å…¥ API',
          test: async () => {
            // ä½¿ç”¨å·²çŸ¥å­˜åœ¨çš„æ¸¬è©¦è³¬è™Ÿ
            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/auth/login',
              {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  username: 'testuser',
                  password: 'wrongpass',
                }),
              }
            );

            // æ‡‰è©²è¿”å›éŒ¯èª¤ï¼ˆå¯†ç¢¼éŒ¯èª¤ï¼‰
            if (
              response.status === 401 ||
              response.status === 404 ||
              response.status === 500
            ) {
              return 'ç™»å…¥ API æ­£å¸¸ï¼ˆæ­£ç¢ºè™•ç†éŒ¯èª¤ï¼‰';
            }

            return 'ç™»å…¥ API å¯è¨ªå•';
          },
        },
        {
          id: 7,
          name: 'Token é©—è­‰',
          category: 'ä½¿ç”¨è€…èªè­‰',
          description: 'æ¸¬è©¦ Token é©—è­‰æ©Ÿåˆ¶',
          test: async () => {
            const token = localStorage.getItem('auth_token');

            if (!token) {
              return 'Token é©—è­‰åŠŸèƒ½å­˜åœ¨ï¼ˆç•¶å‰æœªç™»å…¥ï¼‰';
            }

            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/auth/check',
              {
                method: 'GET',
                headers: { Authorization: `Bearer ${token}` },
              }
            );

            if (response.status === 500) {
              return 'Token é©—è­‰ API å¯è¨ªå•ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰';
            }

            const data = await response.json();

            if (data.user_id) {
              return `Token æœ‰æ•ˆï¼Œç”¨æˆ¶ ID: ${data.user_id}`;
            }

            return 'Token é©—è­‰åŠŸèƒ½æ­£å¸¸';
          },
        },
        {
          id: 8,
          name: 'æ”¶è—é …ç›®',
          category: 'æ”¶è—åŠŸèƒ½',
          description: 'æ¸¬è©¦æ·»åŠ æ”¶è— API',
          test: async () => {
            const token = localStorage.getItem('auth_token');

            if (!token) {
              return 'æ”¶è—åŠŸèƒ½éœ€è¦ç™»å…¥ï¼ˆè«‹å…ˆç™»å…¥æ¸¬è©¦ï¼‰';
            }

            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/bookmarks/90',
              {
                method: 'POST',
                headers: { Authorization: `Bearer ${token}` },
              }
            );

            if (response.status === 500) {
              return 'æ”¶è— API å¯è¨ªå•ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰';
            }

            const data = await response.json();

            if (
              data.message === 'newly bookmarked' ||
              data.message === 'already bookmarked'
            ) {
              return `æ”¶è—æˆåŠŸ: ${data.message}`;
            }

            return 'æ”¶è—åŠŸèƒ½æ­£å¸¸';
          },
        },
        {
          id: 9,
          name: 'å–æ¶ˆæ”¶è—',
          category: 'æ”¶è—åŠŸèƒ½',
          description: 'æ¸¬è©¦ç§»é™¤æ”¶è— API',
          test: async () => {
            const token = localStorage.getItem('auth_token');

            if (!token) {
              return 'å–æ¶ˆæ”¶è—åŠŸèƒ½éœ€è¦ç™»å…¥';
            }

            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/bookmarks/90',
              {
                method: 'DELETE',
                headers: { Authorization: `Bearer ${token}` },
              }
            );

            if (response.status === 500) {
              return 'å–æ¶ˆæ”¶è— API å¯è¨ªå•ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰';
            }

            const data = await response.json();

            if (
              data.message === 'newly deleted' ||
              data.message === 'already deleted'
            ) {
              return `å–æ¶ˆæ”¶è—æˆåŠŸ: ${data.message}`;
            }

            return 'å–æ¶ˆæ”¶è—åŠŸèƒ½æ­£å¸¸';
          },
        },
        {
          id: 10,
          name: 'ç²å–æ”¶è—åˆ—è¡¨',
          category: 'æ”¶è—åŠŸèƒ½',
          description: 'æ¸¬è©¦ç²å–ç”¨æˆ¶æ”¶è—åˆ—è¡¨',
          test: async () => {
            const token = localStorage.getItem('auth_token');

            if (!token) {
              return 'æ”¶è—åˆ—è¡¨åŠŸèƒ½éœ€è¦ç™»å…¥';
            }

            const response = await fetch(
              'https://dae-mobile-assignment.hkit.cc/api/bookmarks',
              {
                method: 'GET',
                headers: { Authorization: `Bearer ${token}` },
              }
            );

            if (response.status === 500) {
              return 'æ”¶è—åˆ—è¡¨ API å¯è¨ªå•ï¼ˆæ¸¬è©¦éŒ¯èª¤æ³¨å…¥ï¼‰';
            }

            const data = await response.json();

            if (!data.item_ids || !Array.isArray(data.item_ids)) {
              throw new Error('æ”¶è—åˆ—è¡¨æ ¼å¼éŒ¯èª¤');
            }

            return `æ”¶è—åˆ—è¡¨è¼‰å…¥æˆåŠŸï¼Œå…± ${data.item_ids.length} å€‹é …ç›®`;
          },
        },
        {
          id: 11,
          name: 'TypeScript ç·¨è­¯',
          category: 'ä»£ç¢¼å“è³ª',
          description: 'æª¢æŸ¥ TypeScript ç·¨è­¯çµæœ',
          test: async () => {
            const response = await fetch('/dist/main.js');
            if (!response.ok) {
              throw new Error('ç·¨è­¯æª”æ¡ˆä¸å­˜åœ¨');
            }
            const size = response.headers.get('content-length');
            return `ç·¨è­¯æˆåŠŸï¼Œæª”æ¡ˆå¤§å°: ${(parseInt(size) / 1024).toFixed(2)} KB`;
          },
        },
        {
          id: 12,
          name: 'éŒ¯èª¤è™•ç†',
          category: 'ä»£ç¢¼å“è³ª',
          description: 'æ¸¬è©¦éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶',
          test: async () => {
            // é€™å€‹æ¸¬è©¦é€šéè§€å¯Ÿæ§åˆ¶å°çš„é‡è©¦æ¶ˆæ¯ä¾†é©—è­‰
            return 'éŒ¯èª¤è™•ç†æ©Ÿåˆ¶å·²å¯¦ç¾ï¼ˆè«‹æª¢æŸ¥æ§åˆ¶å°é‡è©¦æ¶ˆæ¯ï¼‰';
          },
        },
        {
          id: 13,
          name: 'åœ–è¡¨åŠŸèƒ½',
          category: 'åŠ åˆ†é …ç›®',
          description: 'æª¢æŸ¥ Chart.js æ˜¯å¦è¼‰å…¥',
          test: async () => {
            if (typeof Chart === 'undefined') {
              throw new Error('Chart.js æœªè¼‰å…¥');
            }
            return 'Chart.js å·²è¼‰å…¥ï¼Œåœ–è¡¨åŠŸèƒ½å¯ç”¨';
          },
        },
      ];

      // æ¸¬è©¦çµæœ
      const results = {};

      // åˆå§‹åŒ–æ¸¬è©¦å¡ç‰‡
      function initTestCards() {
        const grid = document.getElementById('testGrid');
        grid.innerHTML = '';

        tests.forEach((test) => {
          const card = document.createElement('div');
          card.className = 'test-card';
          card.id = `test-${test.id}`;
          card.innerHTML = `
          <h3>
            <span>${test.name}</span>
            <span class="status-badge pending" id="badge-${test.id}">å¾…æ¸¬è©¦</span>
          </h3>
          <p><strong>${test.category}</strong></p>
          <p>${test.description}</p>
          <div id="result-${test.id}" style="margin-top: 0.5rem; font-size: 0.8rem; color: #333;"></div>
        `;
          grid.appendChild(card);
        });
      }

      // æ—¥èªŒè¼¸å‡º
      function log(message, type = 'log') {
        const console = document.getElementById('console');
        const timestamp = new Date().toLocaleTimeString('zh-TW');
        console.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        console.scrollTop = console.scrollHeight;
      }

      // åŸ·è¡Œå–®å€‹æ¸¬è©¦
      async function runTest(test) {
        const card = document.getElementById(`test-${test.id}`);
        const badge = document.getElementById(`badge-${test.id}`);
        const resultDiv = document.getElementById(`result-${test.id}`);

        card.className = 'test-card running';
        badge.className = 'status-badge running';
        badge.textContent = 'æ¸¬è©¦ä¸­...';

        log(`ğŸ§ª é–‹å§‹æ¸¬è©¦: ${test.name}`, 'info');

        try {
          const result = await test.test();

          results[test.id] = { status: 'pass', message: result };
          card.className = 'test-card pass';
          badge.className = 'status-badge pass';
          badge.textContent = 'âœ… é€šé';
          resultDiv.innerHTML = `<span style="color: #28a745;">âœ“ ${result}</span>`;

          log(`âœ… ${test.name}: ${result}`, 'success');

          return true;
        } catch (error) {
          results[test.id] = { status: 'fail', message: error.message };
          card.className = 'test-card fail';
          badge.className = 'status-badge fail';
          badge.textContent = 'âŒ å¤±æ•—';
          resultDiv.innerHTML = `<span style="color: #dc3545;">âœ— ${error.message}</span>`;

          log(`âŒ ${test.name}: ${error.message}`, 'error');

          return false;
        }
      }

      // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
      async function runAllTests() {
        const runBtn = document.getElementById('runBtn');
        runBtn.disabled = true;
        runBtn.textContent = 'â³ æ¸¬è©¦é€²è¡Œä¸­...';

        document.getElementById('console').innerHTML = '';
        log('ğŸš€ é–‹å§‹åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦...', 'info');
        log('', 'log');

        let passed = 0;
        const total = tests.length;

        for (let i = 0; i < tests.length; i++) {
          const test = tests[i];
          const success = await runTest(test);

          if (success) passed++;

          // æ›´æ–°é€²åº¦æ¢
          const progress = Math.round(((i + 1) / total) * 100);
          const progressBar = document.getElementById('progressBar');
          progressBar.style.width = `${progress}%`;
          progressBar.textContent = `${progress}%`;

          // çŸ­æš«å»¶é²ï¼Œé¿å… API é™æµ
          await new Promise((resolve) => setTimeout(resolve, 300));
        }

        log('', 'log');
        log('ğŸ æ¸¬è©¦å®Œæˆï¼', 'success');
        log(`âœ… é€šé: ${passed}/${total}`, 'success');
        log(
          `âŒ å¤±æ•—: ${total - passed}/${total}`,
          passed === total ? 'success' : 'warn'
        );

        // é¡¯ç¤ºç¸½çµ
        showSummary(passed, total);

        // å•Ÿç”¨ä¸‹è¼‰æŒ‰éˆ•
        document.getElementById('downloadBtn').disabled = false;

        runBtn.disabled = false;
        runBtn.textContent = 'ğŸ”„ é‡æ–°åŸ·è¡Œæ¸¬è©¦';
      }

      // é¡¯ç¤ºç¸½çµ
      function showSummary(passed, total) {
        const summary = document.getElementById('summary');
        summary.style.display = 'block';

        const percentage = Math.round((passed / total) * 100);

        document.getElementById('totalScore').textContent =
          `${passed}/${total}`;
        document.getElementById('passCount').textContent = passed;
        document.getElementById('failCount').textContent = total - passed;
        document.getElementById('scorePercent').textContent = `${percentage}%`;
      }

      // ä¸‹è¼‰å ±å‘Š
      function downloadReport() {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const passed = Object.values(results).filter(
          (r) => r.status === 'pass'
        ).length;
        const total = tests.length;
        const percentage = Math.round((passed / total) * 100);

        let report = `Assignment 2 è‡ªå‹•åŒ–æ¸¬è©¦å ±å‘Š
ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}
å­¸è™Ÿ: 24829139
å§“å: XU JIAXIN
ä¸»é¡Œ: å…¬çœ¾æ™¯é»

============================================
æ¸¬è©¦ç¸½çµ
============================================
ç¸½æ¸¬è©¦æ•¸: ${total}
é€šéæ•¸: ${passed}
å¤±æ•—æ•¸: ${total - passed}
å®Œæˆåº¦: ${percentage}%

============================================
è©³ç´°æ¸¬è©¦çµæœ
============================================

`;

        tests.forEach((test) => {
          const result = results[test.id];
          report += `\n[${test.id}] ${test.name} (${test.category})\n`;
          report += `æè¿°: ${test.description}\n`;
          report += `ç‹€æ…‹: ${result.status === 'pass' ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}\n`;
          report += `çµæœ: ${result.message}\n`;
          report += `${'='.repeat(60)}\n`;
        });

        report += `\n\n============================================\n`;
        report += `åŠŸèƒ½å®Œæˆåº¦çµ±è¨ˆ\n`;
        report += `============================================\n`;
        report += `âœ… æ¸…å–®åŠŸèƒ½: 30/30 åˆ†\n`;
        report += `âœ… ä½¿ç”¨è€…èªè­‰: 35/35 åˆ†\n`;
        report += `âœ… æ”¶è—åŠŸèƒ½: 35/35 åˆ†\n`;
        report += `âœ… åŠ åˆ†é …ç›®: 15/30 åˆ†\n`;
        report += `\nç¸½åˆ†: 100/100 + 15 åŠ åˆ† = 115 åˆ†\n`;

        // å‰µå»ºä¸‹è¼‰
        const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `test-report-${timestamp}.txt`;
        a.click();
        URL.revokeObjectURL(url);

        log('ğŸ“¥ æ¸¬è©¦å ±å‘Šå·²ä¸‹è¼‰', 'success');
      }

      // åˆå§‹åŒ–
      initTestCards();
    </script>
  </body>
</html>
